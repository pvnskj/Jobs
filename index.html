<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>JobScout â€” US Jobs (last 7 days)</title>
  <meta name="color-scheme" content="light dark" />
  <style>
    /* ===== Design Tokens ===== */
    :root{
      --bg: #0b1020;           /* deep indigo */
      --bg2:#0e1326;
      --card:#121833cc;        /* translucent */
      --glass:#ffffff0f;       /* subtle glass */
      --fg: #e7ecff;           /* near-white */
      --mut:#a4acd6;           /* muted */
      --acc:#7c5cff;           /* accent */
      --acc2:#22d3ee;          /* cyan accent */
      --bd:#2b345b;            /* borders */
      --ok:#34d399;            /* green */
      --err:#f87171;           /* red */
      --warn:#fbbf24;          /* amber */
      --shadow: 0 10px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.04);
      --radius:16px;
    }
    *,*:before,*:after{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font-family: ui-sans-serif, system-ui, Segoe UI, Roboto, Helvetica, Arial, Apple Color Emoji, Noto Color Emoji;
         background: radial-gradient(1200px 800px at 20% -10%, #1a2150 0%, transparent 60%),
                     radial-gradient(900px 600px at 110% 10%, #0a4855 0%, transparent 50%),
                     linear-gradient(180deg, var(--bg), #0a0f20 60%);
         color:var(--fg);
    }
    a{color:inherit}
    .wrap{max-width:1000px; margin:0 auto; padding:24px 20px 56px}

    /* ===== Header ===== */
    .hero{position:sticky; top:0; z-index:10; backdrop-filter: blur(10px); background: linear-gradient(180deg, #0b1020cc, #0b102000); padding:18px 0 8px;}
    .title{display:flex; align-items:center; gap:10px;}
    .logo{width:28px; height:28px; border-radius:8px; background: linear-gradient(135deg, var(--acc), var(--acc2)); box-shadow: var(--shadow)}
    h1{margin:0; font-size:clamp(18px,2.4vw,28px); letter-spacing:.2px}
    .sub{margin:6px 0 0; color:var(--mut); font-size:14px}

    /* ===== Search Bar ===== */
    .surface{margin-top:14px; border:1px solid var(--bd); background: linear-gradient(180deg, #131a37cc, #0e142f99); border-radius: var(--radius); box-shadow: var(--shadow)}
    .row{display:grid; grid-template-columns: 1.3fr .5fr .5fr .5fr auto; gap:10px; padding:12px}
    @media (max-width:860px){ .row{grid-template-columns: 1fr 1fr; } }
    @media (max-width:500px){ .row{grid-template-columns: 1fr; } }

    .fld{position:relative}
    .fld input,.fld select{width:100%; padding:12px 12px 12px 40px; color:var(--fg); background:#0f1632; border:1px solid var(--bd); border-radius:12px; outline:none}
    .fld select{padding-left:12px}
    .icon{position:absolute; left:12px; top:50%; transform:translateY(-50%); opacity:.7}

    .btn{padding:12px 14px; border-radius:12px; border:1px solid transparent; background: linear-gradient(135deg, var(--acc), var(--acc2)); color:#0b1020; font-weight:700; cursor:pointer; box-shadow: var(--shadow)}
    .btn:disabled{opacity:.6; cursor:not-allowed}

    /* ===== Meta Bar ===== */
    .metaBar{display:flex; justify-content:space-between; align-items:center; margin:14px 0 8px; color:var(--mut); font-size:13px}
    .chip{display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border:1px solid var(--bd); background:var(--glass); border-radius:999px}

    /* ===== Results Grid ===== */
    .grid{display:grid; grid-template-columns: repeat(auto-fill,minmax(280px,1fr)); gap:12px}
    .card{border:1px solid var(--bd); background: linear-gradient(180deg, #0d152f, #0b1229); border-radius:14px; padding:14px; box-shadow: var(--shadow); min-height:120px}
    .card:hover{transform: translateY(-2px); transition:.2s ease; border-color:#3b48a5}
    .row1{display:flex; align-items:center; gap:10px}
    .badge{font-weight:700; font-size:11px; letter-spacing:.3px; border:1px solid var(--bd); padding:4px 8px; border-radius:999px; background:#0b1230}
    .mut{color:var(--mut); font-size:13px}

    /* ===== Empty / Error / Skeleton ===== */
    .center{display:flex; align-items:center; justify-content:center; padding:30px; color:var(--mut)}
    .toast{position:fixed; right:16px; bottom:16px; background:#1b1f3d; border:1px solid var(--bd); color:var(--fg); padding:10px 12px; border-radius:12px; box-shadow:var(--shadow)}
    .skel{height:116px; border-radius:14px; background: linear-gradient(90deg, #0e1431 25%, #0f1738 37%, #0e1431 63%); background-size: 400% 100%; animation: shine 1.2s infinite}
    @keyframes shine{0%{background-position: 100% 0} 100%{background-position: 0 0}}

    /* ===== Pagination ===== */
    .pager{display:flex; gap:8px; justify-content:center; margin:18px 0}
    .pgbtn{padding:8px 12px; border:1px solid var(--bd); background:#0f1632; color:var(--fg); border-radius:10px; cursor:pointer}
    .pgbtn[disabled]{opacity:.5; cursor:not-allowed}
  </style>
</head>
<body>
  <div class="hero">
    <div class="wrap">
      <div class="title"><div class="logo"></div><h1>JobScout</h1></div>
      <p class="sub">Fresh US roles from the last <span id="daysLabel">7</span> days across major ATS platforms. Type a title, optionally pick a state or toggle remote.</p>
      <div class="surface">
        <div class="row" id="searchBar">
          <div class="fld"><svg class="icon" width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.2-4.2" stroke="currentColor" stroke-width="1.5"/><circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="1.5"/></svg><input id="title" placeholder="e.g., Data Scientist"/></div>
          <div class="fld"><span class="icon">ðŸ“…</span><input id="days" type="number" min="1" max="30" value="7" title="Lookback days"/></div>
          <div class="fld">
            <select id="state" title="US State (optional)">
              <option value="">Any state</option>
              <option>AL</option><option>AK</option><option>AZ</option><option>AR</option><option>CA</option>
              <option>CO</option><option>CT</option><option>DE</option><option>FL</option><option>GA</option>
              <option>HI</option><option>ID</option><option>IL</option><option>IN</option><option>IA</option>
              <option>KS</option><option>KY</option><option>LA</option><option>ME</option><option>MD</option>
              <option>MA</option><option>MI</option><option>MN</option><option>MS</option><option>MO</option>
              <option>MT</option><option>NE</option><option>NV</option><option>NH</option><option>NJ</option>
              <option>NM</option><option>NY</option><option>NC</option><option>ND</option><option>OH</option>
              <option>OK</option><option>OR</option><option>PA</option><option>RI</option><option>SC</option>
              <option>SD</option><option>TN</option><option>TX</option><option>UT</option><option>VT</option>
              <option>VA</option><option>WA</option><option>WV</option><option>WI</option><option>WY</option>
            </select>
          </div>
          <label class="fld" style="display:flex;align-items:center;gap:8px;background:#0f1632;border:1px solid var(--bd);border-radius:12px;padding:0 12px">
            <input id="remote" type="checkbox" /> Remote only
          </label>
          <button class="btn" id="search" type="button">Search</button>
        </div>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="metaBar">
      <div id="count">Enter a title to begin.</div>
      <div class="chip">US-only</div>
    </div>

    <div id="results" class="grid" aria-live="polite"></div>
    <div id="pager" class="pager" hidden>
      <button class="pgbtn" id="prev">Prev</button>
      <button class="pgbtn" id="next">Next</button>
    </div>
  </div>

  <div id="toast" class="toast" hidden></div>

<script>
// ===== Config =====
// For GitHub Pages: call the Worker directly (must include CORS headers). Leave blank to use fallback links.
const WORKER_BASE = '';// e.g., 'https://ats-jobs.yourid.workers.dev'
const DEBUG = true;

// ===== DOM =====
const resultsEl = document.getElementById('results');
const countEl   = document.getElementById('count');
const daysLabel = document.getElementById('daysLabel');
const toastEl   = document.getElementById('toast');
const pagerEl   = document.getElementById('pager');
const prevBtn   = document.getElementById('prev');
const nextBtn   = document.getElementById('next');
const titleEl   = document.getElementById('title');
const daysEl    = document.getElementById('days');
const stateEl   = document.getElementById('state');
const remoteEl  = document.getElementById('remote');
const searchBtn = document.getElementById('search');

// ===== Helpers =====
const showToast=(msg)=>{ toastEl.textContent = msg; toastEl.hidden=false; setTimeout(()=>toastEl.hidden=true, 3000); };
const setCount=(msg)=>{ countEl.textContent = msg; };
const clear=()=>{ resultsEl.innerHTML=''; };
const skels=(n=8)=>{ clear(); for(let i=0;i<n;i++){ const d=document.createElement('div'); d.className='skel'; resultsEl.appendChild(d);} };

function timeAgo(iso){ if(!iso) return ''; const t=new Date(iso), n=new Date(); const s=Math.max(1, (n-t)/1000|0); const U=[[31536000,'year'],[2592000,'month'],[604800,'week'],[86400,'day'],[3600,'hour'],[60,'minute'],[1,'second']]; for(const [sec,label] of U){ if(s>=sec){ const v=(s/sec)|0; return `${v} ${label}${v>1?'s':''} ago`;}} return '' }

function renderCards(list){
  clear();
  if(!list?.length){ resultsEl.innerHTML = '<div class="center">No results. Try a broader title or increase days.</div>'; pagerEl.hidden=true; return; }
  list.forEach(j=>{
    const when = j.posted_at || j.updated_at;
    const card = document.createElement('div');
    card.className='card';
    const u = new URL(j.url, location.href);
    const favicon = `https://www.google.com/s2/favicons?domain=${u.hostname}&sz=64`;
    card.innerHTML = `
      <div class="row1">
        <img src="${favicon}" width="18" height="18" alt="" style="border-radius:4px;opacity:.9"/>
        <span class="badge">${j.source||'ATS'}</span>
        <strong style="font-size:14px">${j.company||'â€”'}</strong>
      </div>
      <div style="margin:8px 0 6px"><a href="${j.url}" target="_blank" rel="noopener" style="text-decoration:none">${j.title||'Untitled role'}</a></div>
      <div class="mut">${j.location||'United States'} Â· ${when?('Posted '+timeAgo(when)):'Date N/A'}</div>
    `;
    resultsEl.appendChild(card);
  });
}

function renderFallback(title, state, remote){
  clear();
  const terms = encodeURIComponent(title);
  const region = state ? `${state}, United States` : 'United States';
  const remoteOnly = remote ? 'remote' : '';
  const blocks = [
    { name:'Greenhouse', url:`https://boards.greenhouse.io/embed/job_board?for=&search=${terms}` },
    { name:'Lever', url:`https://jobs.lever.co/search/${terms}` },
    { name:'Workday (Google)', url:`https://www.google.com/search?q=${encodeURIComponent(`${title} site:myworkdayjobs.com ${remoteOnly} ${region}`)}` },
    { name:'Indeed', url:`https://www.indeed.com/jobs?q=${terms}&l=${encodeURIComponent(region)}${remote?"&sc=0kf%3Aattr%28DSQF7%29%3B":''}` },
    { name:'LinkedIn Jobs', url:`https://www.linkedin.com/jobs/search?keywords=${terms}&location=${encodeURIComponent(region)}${remote?'&f_CF=f_WRA':'&f_CF='}` }
  ];
  setCount('API not configured â€” opening quick links.');
  const g=document.createElement('div'); g.className='grid';
  blocks.forEach(b=>{ const c=document.createElement('div'); c.className='card'; c.innerHTML=`<div class="mut">${region}${remote?' Â· remote':''}</div><div style="margin:8px 0 6px"><a target="_blank" rel="noopener" href="${b.url}">Open ${b.name} search</a></div>`; g.appendChild(c);});
  resultsEl.appendChild(g);
}

function persist(title, days, state, remote){ const u=new URL(location.href); u.searchParams.set('title',title); u.searchParams.set('days',days); state?u.searchParams.set('state',state):u.searchParams.delete('state'); u.searchParams.set('remote', remote?'1':'0'); history.replaceState(null,'',u.toString()); }
function hydrate(){ const u=new URL(location.href); const t=u.searchParams.get('title')||''; const d=u.searchParams.get('days')||'7'; const s=u.searchParams.get('state')||''; const r=u.searchParams.get('remote')==='1'; titleEl.value=t; daysEl.value=d; stateEl.value=s; remoteEl.checked=r; daysLabel.textContent=d; return !!t }

// Client-side pagination (just chunking the array)
const page = { size:24, idx:0, data:[] };
function showPage(){ const start=page.idx*page.size; const end=start+page.size; renderCards(page.data.slice(start,end)); pagerEl.hidden = page.data.length<=page.size; prevBtn.disabled=page.idx===0; nextBtn.disabled=end>=page.data.length; setCount(`${page.data.length} result(s)`); }
prevBtn.onclick=()=>{ if(page.idx>0){ page.idx--; showPage(); window.scrollTo({top:0,behavior:'smooth'});} };
nextBtn.onclick=()=>{ const maxIdx=Math.ceil(page.data.length/page.size)-1; if(page.idx<maxIdx){ page.idx++; showPage(); window.scrollTo({top:0,behavior:'smooth'});} };

async function doSearch(){
  const title = titleEl.value.trim();
  const days  = String(daysEl.value||'7').trim();
  const state = (stateEl.value||'').trim();
  const remote= remoteEl.checked;
  if(!title){ showToast('Enter a job title.'); return; }
  persist(title, days, state, remote);

  if(!WORKER_BASE){ // fallback-first if no API configured
    renderFallback(title, state, remote); return;
  }

  const params = new URLSearchParams();
  params.set('title', title);
  params.set('days', days);
  params.set('country','US');
  if(state) params.set('state', state);
  if(remote) params.set('remote','1');

  skels(8);
  try{
    const r = await fetch(`${WORKER_BASE}/api/jobs?${params.toString()}`, { headers:{'accept':'application/json'} });
    if(!r.ok){ throw new Error('API error '+r.status); }
    const data = await r.json();
    // newestâ†’oldest
    data.sort((a,b)=> new Date(b.posted_at||b.updated_at||0) - new Date(a.posted_at||a.updated_at||0));
    page.data = data; page.idx = 0; showPage();
  }catch(e){
    if(DEBUG) console.error('Fetch failed:', e);
    showToast('Could not reach API. Showing links instead.');
    renderFallback(title, state, remote);
  }
}

// Events
searchBtn.addEventListener('click', doSearch);
daysEl.addEventListener('input', ()=> daysLabel.textContent = daysEl.value );

// Auto-run if shared URL has params
if(hydrate()) doSearch();
</script>
</body>
</html>
